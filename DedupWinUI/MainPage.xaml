<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DedupWinUI.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DedupWinUI"
    xmlns:vm="using:DedupWinUI.ViewModels"
    xmlns:conv="using:DedupWinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:models="using:Services.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <Grid RowSpacing="5">
        <Grid.Resources>
            <Style TargetType="TextBlock" x:Name="Label">
                <Setter Property="Margin" Value="0,0,5,0"/>
            </Style>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <!-- grid view and details -->
            <RowDefinition Height="*"/>
            <!-- status bar-->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <!-- gallery -->
            <ColumnDefinition/>
            <!-- details and analysis -->
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid x:Name="Root" Grid.Column="0" Grid.Row="0" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <CommandBar x:Name="ItemsViewCommandBar">
                <CommandBar.Content>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Image folder:" Margin="5,0" VerticalAlignment="Center"></TextBlock>
                        <TextBlock Text="{x:Bind ViewModel.SourcePath}" Grid.Column="1"
                Margin="5,0" VerticalAlignment="Center" HorizontalAlignment="Stretch"/>
                        <CheckBox IsChecked="{x:Bind ViewModel.Recurse, Mode=TwoWay}" Grid.Column="2">Recurse</CheckBox>
                        <Button x:Name="BtnScan" Command="{x:Bind ViewModel.ScanFilesCommand}"
                    Grid.Column="3" Width="70" >Scan</Button>
                    </Grid>

                </CommandBar.Content>
            </CommandBar>

            <GridView x:Name="ItemsGridView" Grid.Row="1"
                      ItemsSource="{x:Bind ViewModel.Images, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedModel, Mode=TwoWay}"
                      CanDragItems="True" KeyUp="ItemsGridView_KeyUp">
                <!--ContainerContentChanging="ItemsGridView_ContainerContentChanging"-->
                <GridView.Resources>
                    <conv:ImageSourceConverter x:Key="ImageSourceConverter"/>
                    <conv:PathToFileNameConverter x:Key="PathToFileNameConverter"/>
                </GridView.Resources>
                <GridView.GroupStyle>

                </GridView.GroupStyle>
                <GridView.ItemTemplate>
                    <DataTemplate x:DataType="models:ImageModel">
                        <GridViewItem Tapped="GridViewItem_Tapped" Width="128" Height="128">
                            <Grid>
                                <Image x:Name="ItemImage" Source="{x:Bind ThumbnailSource, Mode=OneWay}"
                                Height="128" Width="128" Stretch="Uniform"/>
                                <Border Background="Gray" Opacity="0.7" VerticalAlignment="Bottom">
                                    <TextBlock Text="{x:Bind FileName}" 
                                    VerticalAlignment="Bottom" HorizontalAlignment="Center"/>
                                </Border>
                            </Grid>
                        </GridViewItem>
                    </DataTemplate>
                </GridView.ItemTemplate>
            </GridView>
        </Grid>
        <Grid x:Name="Details" Grid.Column="1" Grid.Row="0" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <CommandBar x:Name="ItemDetailsCommandBar">
                <CommandBar.Content>
                    <StackPanel  Orientation="Horizontal"  HorizontalAlignment="Left">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="DeleteSourceButton" Click="DeleteSourceButton_ClickAsync" CommandParameter="{x:Bind ViewModel.SelectedModel}">Delete</Button>
                            <Button x:Name="RenameSourceButton" Click="RenameSourceButton_Click">Rename</Button>
                            <Button x:Name="FindSimilarToSourceButton" Click="FindSimilarToSourceButton_Click">Similar</Button>
                        </StackPanel>
                        <StackPanel  Margin="4" Width="200">
                            <TextBlock>
                          <Run Text="Scale:"/>
                          <Run Text="{Binding ElementName=ScaleSlider, Path=Value, Mode=OneWay}"/>
                          <Run Text="%"/>
                            </TextBlock>
                            <Slider x:Name="ScaleSlider" Minimum="10" Maximum="100" StepFrequency="10" 
                          Value="{x:Bind ViewModel.SourceImageScale, Mode=TwoWay}"/>
                        </StackPanel>
                    </StackPanel>
                    
                </CommandBar.Content>
            </CommandBar>
            <Grid x:Name="SimImgsView" Grid.Row="1" Margin="1,0,0,0"  VerticalAlignment="Top" HorizontalAlignment="Left">
                <Grid.Resources>
                    <conv:FileSizeConverter x:Key="FileSizeConverter"/>
                </Grid.Resources>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition/>
                </Grid.ColumnDefinitions>
                <!-- image details -->
                <Grid x:Name="FileInfoDetails" VerticalAlignment="Top" HorizontalAlignment="Stretch" Padding="8"
                        Width="350">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Directory: " Grid.Row="0" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="File: " Grid.Row="1" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="Dimensions: " Grid.Row="2" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="Size: "  Grid.Row="3" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="Created: "  Grid.Row="4" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="Th 30x30: " Grid.Row="5" Grid.Column="0" Style="{StaticResource Label}"/>
                    <TextBlock Text="Th 100x100: " Grid.Row="6" Grid.Column="0" Style="{StaticResource Label}"/>
                    
                    <TextBlock Text="{x:Bind ViewModel.SelectedViewModel.FilePath, Mode=OneWay}"
                                Grid.Row="0" Grid.Column="1"/>
                    <TextBlock Text="{x:Bind ViewModel.SelectedViewModel.FileName, Mode=OneWay}" TextWrapping="Wrap"
                                Grid.Row="1" Grid.Column="1"/>
                    <TextBlock Grid.Row="2" Grid.Column="1">
                                <Run Text="W"/>
                                <Run Text="{x:Bind ViewModel.SelectedViewModel.Dimensions.Width, Mode=OneWay}"/>
                                <Run Text="px.  "/>
                                <Run Text="H"/>
                                <Run Text="{x:Bind ViewModel.SelectedViewModel.Dimensions.Height, Mode=OneWay}"/>
                                <Run Text="px."/>
                    </TextBlock>
                    <TextBlock Grid.Row="3" Grid.Column="1" 
                               Text="{x:Bind GetLengthText(ViewModel.SelectedViewModel.Length), Mode=OneWay}"/>
                    <TextBlock Text="{x:Bind ViewModel.SelectedViewModel.CreationTime, Mode=OneWay}"
                                Grid.Row="4" Grid.Column="1"/>
                    <!-- small and smaller thumbnail used for image analysis-->
                    <Image Grid.Column="1" Grid.Row="5"  Margin="0,5"
                           VerticalAlignment="Top" HorizontalAlignment="Left" Stretch="Uniform"
                           Width="{x:Bind ViewModel.HashImageSize}" Height="{x:Bind ViewModel.HashImageSize}"
                           Source="{x:Bind ViewModel.SelectedViewModel.Model.ThumbnailSource, Mode=OneWay}" />
                    <Image Grid.Column="1" Grid.Row="6" Margin="0,5"
                           VerticalAlignment="Top" HorizontalAlignment="Left" Stretch="Uniform" 
                           Width="{x:Bind ViewModel.ThumbnailSize}" Height="{x:Bind ViewModel.ThumbnailSize}"
                           Source="{x:Bind ViewModel.SelectedViewModel.Thumbnail, Mode=OneWay}">

                    </Image>
                </Grid>
                <!-- image preview-->
                <Viewbox Grid.Row="0" Grid.Column="1" Scale="{x:Bind ViewModel.SourceImageViewboxScale, Mode=OneWay}"
                         VerticalAlignment="Top" HorizontalAlignment="Left">
                    <Image Source="{x:Bind ViewModel.SelectedViewModel.FullName, Mode=OneWay}" Stretch="Uniform"/>
                </Viewbox>
            </Grid>
            <GridView x:Name="SimilarImagesGridView" VerticalAlignment="Top" Grid.Row="2"/>
        </Grid>
        <!-- status -->
        <Grid x:Name="StatusBar" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal">
                    <TextBox Text="{x:Bind ViewModel.StatusText, Mode=OneWay}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Page>
